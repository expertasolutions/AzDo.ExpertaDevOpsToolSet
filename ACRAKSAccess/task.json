{
  "id": "585c72b7-52df-4afc-be01-51a5ed7e5c78",
    "name": "ACRAKSAccess",
    "friendlyName": "ACRAKS Access",
    "description": "Set ACR Access to Kubernetes cluster",
    "helpMarkDown": "",
    "category": "Utility",
    "preview": true,
    "author": "Solutions Experta Inc.",
    "version": {
        "Major": 0,
        "Minor": 0,
        "Patch": 0
    },
    "instanceNameFormat": "Set ACR Access to Kubernetes cluster",
    "groups": [],
    "inputs": [
        {
          "name": "azureSubscriptionEndpoint",
          "type": "connectedService:AzureRM",
          "label": "Azure subscription",
          "helpMarkDown": "Select the Azure Resource Manager subscription, which contains Azure Container Registry.Note: To configure new service connection, select the Azure subscription from the list and click 'Authorize'. If your subscription is not listed or if you want to use an existing Service Principal, you can setup an Azure service connection using 'Add' or 'Manage' button.",
          "defaultValue": "",
          "required": true
        },
        {
          "name": "registerMode",
          "label": "Access mode",
          "type": "pickList",
          "defaultValue": "RBAC",
          "options": {
            "rbac": "RBAC",
            "aksSecret": "AKS Secret"
          },
          "required": false
        },
        {
          "name": "acrResourceGroupName",
          "label": "Container registry resource group",
          "type": "pickList",
          "defaultValue": "",
          "required": true,
          "helpMarkDown": ""
        },
        {
          "name": "containerRegistry",
          "label": "Azure Container Registry",
          "type": "pickList",
          "defaultValue":"",
          "required": true
        },
        {
          "name": "aksResourceGroupName",
          "label": "Azure Kubernetes cluster resource group",
          "type": "pickList",
          "defaultValue": "",
          "helpMarkDown": ""
        },
        {
          "name": "aksCluster",
          "label": "Azure Kubernetes cluster",
          "type": "pickList",
          "defaultValue": "",
          "helpMarkDown": ""
        },
        {
          "name": "acrUsername",
          "label": "Azure Container Registry username",
          "type": "string",
          "defaultValue": "",
          "helpMarkDown" :"",
          "visibleRule": "registrerMode = aksSecret"
        },
        {
          "name": "acrPasswordToken",
          "label": "Azure Container Registry Password Token",
          "type": "string",
          "defaultValue": "",
          "helpMarkDown" :"",
          "visibleRule": "registrerMode = aksSecret"
        }
    ],
    "dataSourceBindings" : [
      {
        "target": "acrResourceGroupName",
        "endpointId": "$(azureSubscriptionEndpoint)",
        "endpointUrl": "{{{endpoint.url}}}/subscriptions/{{{endpoint.subscriptionId}}}/providers/Microsoft.ContainerRegistry/registries?api-version=2017-10-01",
        "resultSelector": "jsonpath:$.value[*]",
        "resultTemplate": "{{{ #extractResource id resourcegroups}}}"
      },
      {
        "target":"containerRegistry",
        "endpointId":"$(azureSubscriptionEndpoint)",
        "endpointUrl":"{{{endpoint.url}}}/subscriptions/{{{endpoint.subscriptionId}}}/resourceGroups/$(acrResourceGroupName)/providers/Microsoft.ContainerRegistry/registries?api-version=2017-10-01",
        "resultSelector":"jsonpath:$.value[*]",
        "resultTemplate":"{{{name}}}"
      },
      {
        "target":"aksResourceGroupName",
        "endpointId":"$(azureSubscriptionEndpoint)",
        "endpointUrl": "{{{endpoint.url}}}/subscriptions/{{{endpoint.subscriptionId}}}/providers/Microsoft.ContainerService/managedClusters?api-version=2017-08-31",
        "resultSelector": "jsonpath:$.value[*]",
        "resultTemplate": "{{{ #extractResource id resourcegroups}}}"
      },
      {
        "target":"aksCluster",
        "endpointId":"$(azureSubscriptionEndpoint)",
        "endpointUrl": "{{{endpoint.url}}}/subscriptions/{{{endpoint.subscriptionId}}}/resourceGroups/$(aksResourceGroupName)/providers/Microsoft.ContainerService/managedClusters?api-version=2017-08-31",
        "resultSelector": "jsonpath:$.value[*]",
        "resultTemplate": "{{{name}}}"
      }
    ],
    "outputVariables" : [],
    "execution": {
        "Node": {
          "target": "src//acraksaccess.js",
          "argumentFormat": ""
        }
      }
}